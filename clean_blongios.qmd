---
title: "clean_blongios"
format: html
editor: visual
---

```{r setup}
#| include: false
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE, 
  echo = FALSE
)
#ce code permet de n'afficher aucun message parasite ni les warnings. 
```

# Analyse des observations de Blongios nain (Ixobrychus minutus) dans la Reserve Naturelle du Bagnas

## 1. Introduction

::: justify
Le Blongios nain (Ixobrychus minutus) est une espèce emblématique des zones humides, inféodée aux roselières inondées, aux berges de lacs et de cours d’eau ainsi qu’aux marais, qui lui fournissent à la fois des ressources alimentaires et des sites favorables à la nidification. Particulièrement discret, il demeure le plus souvent dissimulé au sein de la végétation, ce qui rend son observation difficile. Il s’agit d’une espèce migratrice, quittant les sites de reproduction européens à la fin de l’été pour hiverner principalement en Afrique subsaharienne. L’Inventaire national du patrimoine naturel réalisé entre 2013 et 2015, indique que l’espèce est présente dans une cinquantaine de départements de France métropolitaine, notamment dans le nord du territoire (Hauts-de-France, Île-de-France), l’est (Grand Est, Auvergne-Rhône-Alpes), les départements littoraux du sud le long de la Méditerranée, ainsi que dans quelques départements du centre du pays. Toutefois, un déclin des populations est observé depuis les années 1970, principalement lié à la raréfaction et à la dégradation de ses habitats de reproduction. En conséquence, le Blongios nain est classé « En danger » (EN) sur la Liste rouge nationale, tandis qu’il est considéré en « Préoccupation mineure » (LC) à l’échelle européenne. Dans ce contexte, la réserve naturelle du Bagnas a exprimé le besoin de disposer d’une analyse approfondie des données d’observation du Blongios nain collectées sur le site entre 1990 et 2021. L’objectif est, dans un premier temps, de comparer les données opportunistes à celles issues de protocoles standardisés de suivi — notamment les points d’écoute visant la détection des mâles chanteurs — afin d’évaluer l’efficacité et la pertinence des différents dispositifs de suivi. Dans un second temps, il s’agit de caractériser la structure spatio-temporelle de la présence du Blongios nain au sein de la réserve. Nous nous sommes ainsi interrogés sur la structure de l’effort de prospection au cours du temps, tant à l’échelle annuelle que journalière, ainsi que sur les facteurs influençant la détection de l’espèce lors des prospections, en lien avec sa phénologie et les modalités d’échantillonnage.
:::

## 2. Importation des packages

```{r}

library(tidyverse) 
library(lubridate) 
library(readxl) 
library(ggplot2) 
library(dplyr)
library(gridExtra)
library(readr)
library(knitr)
library(lme4)
library(leaflet)
library(sf)
library(ggeffects)

```

## 3. Definition du répertoire de travail et importation des données

```{r}

# A changer selon votre chemin d'accès personnel 

process_data <- read.csv("data/pro/process_data.csv")
process_protocole <- read.csv("data/pro/process_protocole.csv")

```

## 4. Analyses exploratoires

### A) Répartition temporelle des observations de Blongios nain depuis 1990

En premier lieu, nous voulions visualiser l'absence et la présence du Blongios nain sur toute la période d'étude. Pour cela, nous avons créé une grille années X semaines qui montre toutes les sorties avec et sans observation d'individus. Les cases du graphiques sont colorées de manière à différentier (i) les semaines avec observation d'un Blongios lors d'un protocole standardisé, (ii) les semaines avec observation opportuniste d'un Blongios, (iii) les semaines avec à la fois des observations opportuniste et par protocole standardisé, et (iiii) les semaines sans observation d'un Blongios.

```{r}

# Définir l'espèce d'intérêt
esp_blongios <- "Blongios nain, Butor blongios"

# Extraire les années des dates de début
annees <- as.integer(format(as.Date(process_data$date_debut), "%Y"))

# Trouver les années min et max
annee_min <- min(annees, na.rm = TRUE)
annee_max <- max(annees, na.rm = TRUE)
duree_annees <- annee_max - annee_min +1

# Filtrer les données pour le blongios et ajouter les colonnes année_suivi et semaine
data_blongios <- process_data %>%
  filter(nom_vernaculaire == esp_blongios) %>% 
  mutate(
    annee_suivi = year(date_debut) - annee_min + 1,
    annee_reelle = year(date_debut),
    semaine = isoweek(date_debut))

# Résumer les données par année_suivi et semaine
data_blongios_summarized <- data_blongios %>%
  mutate(
    is_obs = nombre_min > 0,
    is_protocole = grepl("SuiviBlongiosTalève", champs_additionnels)) %>%
  group_by(annee_suivi, semaine) %>%
  summarise(
    statut = case_when(
       # sorties avec observations 
      any(is_obs) & any(is_protocole & is_obs) & any(!is_protocole & is_obs) ~ "obs_mixte", # au moins 1 observation protocole ET 1 opportuniste = observation mixte 
      any(is_obs) & any(is_protocole & is_obs) ~ "obs_protocole", # au moins 1 observation protocolée (et aucune opportuniste) = observation protocolée 
      any(is_obs) & any(!is_protocole & is_obs) ~ "obs_hors_protocole", # au moins 1 observation opportuniste (et aucune protocolée) = observation hors protocole
      !any(is_obs) & any(nombre_min == 0) ~ "sortie_sans_observation",  # sorties sans observation = aucun oiseau vu
      TRUE ~ NA_character_),
    .groups = "drop")

# Créattion d'une grille complète (années x semaines)
grille <- expand.grid(
  annee_suivi = 1:duree_annees,
  semaine = 1:53
) %>%
  mutate(annee_reelle = annee_min + annee_suivi - 1) %>%
  left_join(
    data_blongios_summarized,
    by = c("annee_suivi", "semaine")
  ) %>%
  mutate(statut = ifelse(is.na(statut), "pas_de_sortie", statut)) # semaines sans sortie
grille <- grille %>%
  mutate(statut = factor(statut,
                         levels = c("obs_protocole", "obs_hors_protocole", "obs_mixte",
                                    "sortie_sans_observation", "pas_de_sortie")))

# Visualisation graphique
ggplot(grille, aes(x = semaine, y = annee_reelle, fill = statut)) +
  geom_tile(color = "white", linewidth = 0.2) +
  geom_hline(yintercept = 2014, color = "blue", linetype = "dashed", size = 0.4)+
  scale_y_reverse() +
  scale_fill_manual(
    values = c(
      "obs_protocole" = "red",
      "obs_hors_protocole" = "green",
      "obs_mixte" = "purple",
      "sortie_sans_observation" = "black",
      "pas_de_sortie" = "grey85"),
    labels = c(
      "Observation (protocole)",
      "Observation (hors protocole)",
      "Observation (mixte)",
      "Sortie sans observation",
      "Pas de sortie")) +
  labs(
    title = paste("Observations de", esp_blongios),
    subtitle = paste("Suivi de", annee_min, "à", annee_max),
    x = "Semaine de l'année",
    y = "Année") +
  theme_minimal() +
  theme(panel.grid = element_blank())

```

Premièrement, on observe que l’ensemble des observations est concentré approximativement entre les semaines 16 et 35 (printemps–été), ce qui correspond bien à la période de présence du Blongios nain sur le littoral méditerranéen français. Le protocole de suivi standardisé a débuté en 2014, avec plusieurs passages réalisés tous les deux ans environ (entre 3 et 8 passages selon les années). Enfin, les résultats suggèrent une diminution de la présence du Blongios nain sur la réserve au cours du temps. En effet, le nombre total de semaines avec au moins une observation semble décroître, avec seulement deux semaines de présence détectée en 2024 contre onze en 2004. Cette tendance pourrait indiquer soit un déclin de la population globale, soit une diminution de l’attractivité écologique du site du Bagnas pour la population nicheuse.

### B) Répartition spatiale des observations de Blongios nain issues du protocole standardisé de suivi

Ensuite, nous voulions visualiser la répartition spatiale des observations de Blongios nain issues du protocole standardisé de suivi. Pour cela, nous avons créé une carte avec des cercles dont la taille est proportionnelle au nombre total d'individus entendus/vus sur chaque site d'écoute depuis le début du protocole en 2014.

```{r}

# Filtre uniquement les données du blongios nain protocolé
process_protocole_blongios <- process_protocole %>%
  filter(nom_vernaculaire=="Blongios nain, Butor blongios")

# Préparer le format des coordonnées pour R 
sites_protocole_blongios <- st_as_sf(process_protocole_blongios, coords = c("x_centroid_4326", "y_centroid_4326"), crs = 4326)

# On rassemble les données pour avoir un dataframe avec 1 ligne par site d'étude. L'objectif est d'avoir le nombre d'écoute de Blongios par site (somme depuis 2014)

sites_protocole_blongios <- sites_protocole_blongios %>%
  group_by(nom_lieu, nom_vernaculaire, geometry) %>%
  summarise(
    somme_nombre_min = sum(nombre_min, na.rm = TRUE),
    .groups = "drop")


leaflet() %>%
  addTiles() %>%     
addCircleMarkers(
    data =sites_protocole_blongios, # on prend les data frame résumé avec 1 ligne par site
    radius = ~somme_nombre_min, # la taille des points est proportionnelle au nombre d'oiseaux entendus
    color = "red",
    fillOpacity = 0.9,
    popup = ~paste ((nom_lieu), ", Blongios entendus :" ,(somme_nombre_min), sep = "")
  ) %>%  # cela nous donne le nom du lieu suivi du nombre de blongios entendu sur le site depuis 2014 
  setView(lng = 3.51, lat = 43.31, zoom = 13)


```

Sur cette carte on peut voir que certains sites semblent plus propice à l'observation d'individus de Blongios nain que d'autres. Notamment les sites n°5 et 6 semblent être les plus favorables à l'observation de cette espèce.

### C) Effort d'échantillonnage journalier et répartition temporelle journalière des observations protocolées de Blongios nain

Ici, nous voulions comprendre à quel moment de la journée était réalisé le protocole, et quelles étaient les horaires qui permettaient une meilleure détection de l'espèce. Pour cela, nous avons réalisé un graphique qui représente l’effort d’échantillonnage ainsi que le nombre d’obervations cumulés au cours du protocole blongios pour chaque heure de la journée de 2014 à 2025. L’effort d’échantillonnage est représenté par la somme des sorties effectuées.

```{r}
# Données 
process_protocole <- read_csv("data/pro/process_protocole.csv")

Protocole_SuiviBlongiosTaleve <- process_protocole %>%
  filter(
    champs_additionnels == "{'RELV_NOM': 'SuiviBlongiosTalève'}" &
      nom_vernaculaire %in% c(
        "Blongios nain, Butor blongios",
        "Talève sultane, Poule sultane, Porphyrion bleu"
      )
  )
Protocole_Blongios <- Protocole_SuiviBlongiosTaleve %>%
  mutate(
    heure_debut = as.POSIXct(heure_debut, format = "%H:%M:%S"),
    heure_debut_tronc = hour(heure_debut),
    date = as.Date(heure_debut)
  )

Protocole_Blongios <- Protocole_Blongios %>% filter( nom_vernaculaire == "Blongios nain, Butor blongios")

Protocole_Blongios <- Protocole_Blongios  %>%
  mutate(heure_debut = as.POSIXct(heure_debut, format = "%H:%M:%S")) %>%
  filter(format(heure_debut, "%H:%M:%S") != "00:00:00")

# Table des 24 heures

heures_jour <- tibble(heure_debut_tronc = 0:23)

### Sommer les obs par heure

obs_heure <- Protocole_Blongios %>%
  group_by(heure_debut_tronc) %>%
  summarize(sum(nombre_min)) 
obs_heure

### Frequence horaire
freq_heure <- Protocole_Blongios %>% group_by(heure_debut_tronc) %>% summarise(freq = n()) %>% mutate(freq_rel = freq / sum(freq))

# Compléter les heures manquantes avec 0
data_plot_h <- heures_jour %>%
  left_join(freq_heure, by = "heure_debut_tronc") %>%
  left_join(obs_heure, by = "heure_debut_tronc") %>%
  mutate(
    freq = replace_na(freq, 0),
    `sum(nombre_min)` = replace_na(`sum(nombre_min)`, 0),
    heure_debut_tronc = factor(heure_debut_tronc, levels = 0:23)
  )

### Barplot

ggplot(data_plot_h, aes(x = heure_debut_tronc)) +
  geom_bar(aes(y = freq),
           stat = "identity",
           width = 0.8,
           fill = "orange") +
  geom_bar(aes(y = `sum(nombre_min)`),
           stat = "identity",
           width = 0.4,
           fill = "blue") +
  theme_classic() +
  scale_y_continuous(expand = c(0, 0)) +
  xlab("Heure de la journée") +
  ylab("Nombre de prospections (orange)\n et d'observations (bleu)") +
  ggtitle("Effort d'échantillonnage et nombre d'observations\n par heure pour le protocole Blongios (2014-2018)")
```

Ici, on observe que les sorties protocolées sont majoritairement réalisées entre 6 h et 7 h du matin ainsi qu’entre 20 h et 21 h, ce qui correspond aux plages horaires du protocole standardisé et aux périodes d’activité maximale du Blongios nain. Ces créneaux apparaissent pertinents, puisque c’est durant ces périodes que l’espèce est le plus fréquemment détectée

### D) Effort d'échantillonnage journalier et répartition temporelle journalière des observations opportunistes de Blongios nain

Similairement, ici nous voulions comprendre à quel moment de la journée était faites les sorties hors protocole standardisé, et quelles étaient les horaires qui permettaient une meilleure détection de l'espèce sur ce type de données. Pour cela, nous avons réalisé un graphique qui représente le nombre d’obervations hors protocole cumulés pour chaque heure de la journée de 1997 à 2023. Il est important de préciser que les sorties hors protocole où l'heure d'observation est identifiée sont très rares (n=46), et correspondent en majorité à des données produites lors d'autres protocoles non dédiés à cette espèce.

```{r}

## Filtrage des données opportunistes
Opportuniste_Blongios<- process_data %>%
  filter( nom_vernaculaire == "Blongios nain, Butor blongios" &
    !champs_additionnels == "{'RELV_NOM': 'SuiviBlongiosTalève'}" )
     

## Preparation des données
Opportuniste_Blongios <- Opportuniste_Blongios %>%
  mutate(
    heure_debut = as.POSIXct(heure_debut, format = "%H:%M:%S"),
    heure_debut_tronc = hour(heure_debut),
    date = as.Date(heure_debut))

Opportuniste_Blongios <- Opportuniste_Blongios %>%
  mutate(heure_debut = as.POSIXct(heure_debut, format = "%H:%M:%S")) %>%
  filter(format(heure_debut, "%H:%M:%S") != "00:00:00")

## Table des 24 heures

heures_jour <- tibble(heure_debut_tronc = 0:23)

## Additionner les observations par heure

obs_heure <- Opportuniste_Blongios %>%
  group_by(heure_debut_tronc) %>%
  summarize(sum(nombre_min)) 
obs_heure

## Frequence horaire
freq_heure <- Opportuniste_Blongios %>% group_by(heure_debut_tronc) %>% summarise(freq = n()) %>% mutate(freq_rel = freq / sum(freq))

## Compléter les heures manquantes avec 0
data_plot_h <- heures_jour %>%
  left_join(freq_heure, by = "heure_debut_tronc") %>%
  left_join(obs_heure, by = "heure_debut_tronc") %>%
  mutate(
    freq = replace_na(freq, 0),
    `sum(nombre_min)` = replace_na(`sum(nombre_min)`, 0),
    heure_debut_tronc = factor(heure_debut_tronc, levels = 0:23))

## Barplot

ggplot(data_plot_h, aes(x = heure_debut_tronc)) +
  geom_bar(aes(y = `sum(nombre_min)`),
           stat = "identity",
           width = 0.4,
           fill = "blue") +
  theme_classic() +
  scale_y_continuous(expand = c(0, 0)) +
  xlab("Heure de la journée") +
  ylab("Nombre de prospections (orange)\n et d'observations (bleu)") +
  ggtitle("Nombre d'observations hors protocole\n par heure pour le Blongios (1997-2023)")


```

On remarque que hors protocole standardisé, le Blonios nain est essentiellement entre 6 et 11h du matin et entre 19 et 21h du soir, ce qui correspond bien à son pic d'activité (aube et crépuscule), et au horaires de prospections choisies pour le protocole dédié au Blongios nain.

# 3. Preparation du jeu de données et des variables

Pour les analyses de présence et d’abondance, nous utilisons uniquement les données d’observation du blongios provenant des observations protocolées. Ce jeu de données sera nommé \*\*Protocole_SuiviBlongios\*\*

```{r}
process_protocole <- read_csv("data/pro/process_protocole.csv")

Protocole_SuiviBlongios<- process_protocole %>%
  filter(
    champs_additionnels  == "{'RELV_NOM': 'SuiviBlongiosTalève'}" &
      nom_vernaculaire ==
        "Blongios nain, Butor blongios"
      )

#Protocole_SuiviBlongios2<- process_protocole %>%
#  filter(
#    champs_additionnels  != "{'RELV_NOM': 'SuiviBlongiosTalève'}" &
#      nom_vernaculaire ==
#        "Blongios nain, Butor blongios"
 #     )
```

Le tableau résulte de la fusion d’un tableau contenant les variables environnementales (*environnement_daily*) et d’un tableau regroupant les observations de talèves.

Nous allons préparer les variables environnementales, c’est‑à‑dire les standardiser afin qu’elles ne soient pas influencées par leur unité et pour éviter une sur‑ ou sous‑dispersion.

```{r}
#| include: false
#standardidation
Protocole_SuiviBlongios$annee <- as.numeric(Protocole_SuiviBlongios$annee)
Protocole_SuiviBlongios$julian <- as.numeric(Protocole_SuiviBlongios$julian)
Protocole_SuiviBlongios$annee <- as.numeric(Protocole_SuiviBlongios$annee)
Protocole_SuiviBlongios$nom_lieu<- as.character (Protocole_SuiviBlongios$nom_lieu)

# enviro 
Protocole_SuiviBlongios$temp_moy_glissante_31j <-as.numeric(Protocole_SuiviBlongios$temp_moy_glissante_31j)
Protocole_SuiviBlongios$temp_moy_glissante_7j <- as.numeric(Protocole_SuiviBlongios$temp_moy_glissante_7j)
Protocole_SuiviBlongios$pluie_moy_glissante_7j <-as.numeric(Protocole_SuiviBlongios$pluie_moy_glissante_7j)
Protocole_SuiviBlongios$pluie_moy_glissante_31j <- as.numeric(Protocole_SuiviBlongios$pluie_moy_glissante_31j)
Protocole_SuiviBlongios$vent_moyen<-
as.numeric(Protocole_SuiviBlongios$vent_moyen)
Protocole_SuiviBlongios$temperature =  as.numeric(Protocole_SuiviBlongios$temperature)
Protocole_SuiviBlongios$pluie_1h =  as.numeric(Protocole_SuiviBlongios$pluie_1h)

#hydro 

Protocole_SuiviBlongios$Profondeur <-  as.numeric(Protocole_SuiviBlongios$Profondeur )
Protocole_SuiviBlongios$AssecT_1 <- as.factor(Protocole_SuiviBlongios$AssecT_1 )

```

# 4. Analyses de la population de blongios

## 4.1 . Modèle de présence/absence

```{r}


## création de la variable Occurence (1 si au moins un individu observé, 0 sinon)
Protocole_Blongios$Occurence <- ifelse(Protocole_Blongios$nombre_min > 0, 1, 0)

### Modeles emboités 

modele_julian2_annee <- glm(Occurence ~ julian + I(julian^2)+annee,
                   data = Protocole_Blongios, 
                   family = binomial)
modele_complet_site <- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_anneesite <- glm(Occurence~ annee*nom_lieu + julian + I(julian^2),
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_site <- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_vent <- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_temp_31 <- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + temp_moy_glissante_31j+ vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_temp_7j <- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + temp_moy_glissante_7j+ vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_temp_1j<- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + temperature,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_temp_1j_vent<- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + temperature + vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_pluie_31j_vent<- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_31j + vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_pluie_7j_vent<- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_7j + vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )
modele_complet_pluie_1j_vent<- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + pluie_1h + vent_moyen,
                        data = Protocole_Blongios, 
                   family = binomial )


AIC(modele_complet_site, modele_complet_anneesite, modele_complet_vent , modele_complet_temp_31, modele_complet_temp_7j, 
modele_complet_temp_1j, modele_complet_temp_1j_vent, modele_complet_pluie_31j_vent, modele_complet_pluie_7j_vent, modele_complet_pluie_1j_vent)


```

le tableau d'AIC des différents modèles de présence/absence permet de choisir le modèle qui fit le plus les données. On choisit donc le modele_complet_pluie_7j_vent. Il contient : annee + julian + I(julian\^2)+ nom_lieu + pluie_moy_glissante_7j + vent_moyen

```{r}

## meilleur modèle selon AIC

modele_complet_pluie_7j_vent<- glm(Occurence~ annee + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_7j + vent_moyen,
                        data = Protocole_Blongios, 
                        family = binomial)

summary(modele_complet_pluie_7j_vent)
```

Ce summary du modèle choisi nous montre s'il y a des variables significatives. Ici il n'y en a pas.

##2.1 interpretation

Le modèle GLM examinant la présence du Blongios nain en fonction du temps, de la profondeur et de l’assec de l’année précédente montre plusieurs résultats intéressants. La date julienne sur plusieurs années et son terme quadratique sont toutes deux significatifs (p ≈ 0,0015), suggérant une évolution non linéaire et négative de la probabilité de présence au cours de la période 2014–2024. La profondeur moyenne n’a pas d’effet significatif (p = 0,34), ce qui indique que la présence de l’espèce n’est pas fortement liée aux variations de profondeur dans ce dataset. En revanche, l’assec de l’année précédente influence fortement la probabilité de présence: un assec partiel réduit la probabilité (Estimate = -2,19, p = 0,03) et un assec total encore davantage (Estimate = -4,27, p = 0,002)

## 4.2 Modèle d'abondance

Cette analyse vise à caractériser la dynamique de la population de blongios et à déterminer l'influence relative des variables temporelles (année, date julienne) et environnementales (précipitations et temperatures) sur l'abondance observée.

Nous réalisons cette analyse sur seulement les observations qui proviennent du protocole (donc pas les observations opportunistes)

```{r}
#| eval: false
#| include: false
#  Modèle dans le temps 
# y ~ Pois ( lambda)

modele_annee <- glm(nombre_min ~ annee, 
                    family = poisson, 
                    data = Protocole_SuiviBlongios)


modele_julian <- glm(nombre_min ~ julian, 
                   data = Protocole_SuiviBlongios, 
                   family = poisson)


modele_annee_julian <- glm(nombre_min ~ annee + julian, 
                         data = Protocole_SuiviBlongios, 
                         family = poisson)

modele_anneejulian <- glm(nombre_min ~ annee * julian, 
                         data = Protocole_SuiviBlongios, 
                         family = poisson)

#modèle complet 
modele_complet_site <- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )

# summary(modele_annee)
# summary(modele_jour)
# summary(modele_annee_jour)
# summary(modele_anneejour)

AIC(modele_annee, modele_julian, modele_annee_julian, modele_anneejulian)

```

```{r}
modeleB_complet_vent <- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + vent_moyen,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )


modeleB_complet_temp_31 <- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + temp_moy_glissante_31j+ vent_moyen,
                              data = Protocole_SuiviBlongios, 
                              family = poisson )

modeleB_complet_temp_7j <- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + temp_moy_glissante_7j+ vent_moyen,
                              data = Protocole_SuiviBlongios, 
                              family = poisson )


modeleB_complet_temp_1j_vent<- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + temperature + vent_moyen,
                                  data = Protocole_SuiviBlongios, 
                                  family = poisson )

modeleB_complet_pluie_31j_vent<- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_31j + vent_moyen,
                                    data = Protocole_SuiviBlongios, 
                                    family = poisson )

modeleB_complet_pluie_7j_vent<- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_7j + vent_moyen,
                                   data = Protocole_SuiviBlongios, 
                                   family = poisson )

modeleB_complet_pluie_1j_vent<- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + pluie_1h + vent_moyen,
                                   data = Protocole_SuiviBlongios, 
                                   family = poisson )




# avec hydro 

modeleB_complet_assec <- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + vent_moyen + AssecT_1,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )
                           
modeleB_complet_profondeur <- glm(nombre_min~ annee + julian + I(julian^2)+ nom_lieu + vent_moyen + Profondeur,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )

AIC_tab = AIC( 
              modeleB_complet_vent,
              modeleB_complet_temp_31,
              modeleB_complet_temp_7j,
              modeleB_complet_temp_1j_vent,
              modeleB_complet_pluie_31j_vent,
              modeleB_complet_pluie_7j_vent,
              modeleB_complet_pluie_1j_vent,
              modeleB_complet_assec,
              modeleB_complet_profondeur) %>%
  as.data.frame() %>%
  rownames_to_column("Modèle") %>%
  arrange(AIC) %>%
  mutate(
    delta_AIC = AIC - min(AIC)
  )

kable(
  AIC_tab,
  digits = 2,
  caption = "Comparaison des modèles selon le critère d'information d'Akaike (AIC)"
)

  

```

La sélection de modèles basée sur le critère d’information d’Akaike (AIC) a mis en évidence qu’un modèle intégrant les effets temporels (année et jour julien), un effet spatial lié au site, ainsi que des variables environnementales locales (vitesse moyenne du vent et pluie) constitue la structure la plus parcimonieuse pour expliquer la variation de l’abondance des individus. Ce modèle (modeleB_complet_pluie_7j_vent) a donc été retenu comme base pour l’analyse, afin d’évaluer l’influence conjointe des facteurs temporels, spatiaux et environnementaux sur l'abondance des individus blongios

Le tableau suivant (tab. X) présente les estimations des paramètres du modèle ainsi que les valeurs de *p*, permettant d’évaluer l’existence d’effets significatifs sur l’abondance du blongios au sein de la réserve.

```{r}
res <- summary(modeleB_complet_pluie_7j_vent)

coef_tab <- res$coefficients

table_coef_p <- coef_tab[, c("Estimate", "Pr(>|z|)")]

table_coef_p <- round(table_coef_p, 3)

kable(
  table_coef_p ,
  digits = 2,
  caption = "Les estimations des parametres avec leur p-value)"
)
```

```{r}
null_dev <- modeleB_complet_pluie_7j_vent$null.deviance
resid_dev <- modeleB_complet_pluie_7j_vent$deviance

pseudo_R2 <- (null_dev - resid_dev) / null_dev
```

> Nous pouvons constater qu’aucune valeur de *p* n’est inférieure au seuil de 5 %. Par conséquent, aucune des variables incluses dans le modèle n’a d’effet significatif sur l’abondance de la population de blongios dans la réserve du Bagnas.
>
> Le modèle explique environ 22 % de la variation de l’abondance des talèves (pseudo-R² = `r pseudo_R2`), ce qui suggère que d’autres facteurs non inclus dans le protocole pourraient jouer un rôle important dans la distribution et l’abondance de cette espèce.
