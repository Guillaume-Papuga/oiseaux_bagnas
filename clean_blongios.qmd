---
title: "clean_blongios"
format: html
editor: visual
---

```{r setup}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE
)
#ce code permet de n'afficher auxun message parasite ni les warnings. 
```

#Charger les données et les library

```{r}

library(tidyverse) 
library(lubridate) 
library(readxl) 
library(ggplot2) 
library(dplyr)
library(gridExtra)
library(readr)
library(knitr)
library(lme4)
library(leaflet)
library(sf)

#à changer selon votre chemin d'accès personnel 
setwd("~/Desktop/M2/projet biodiversite/oiseaux_bagnas/data/pro")
process_data <- read_csv("~/Desktop/M2/projet biodiversite/oiseaux_bagnas/data/pro/process_data.csv")

```

## 1. analyses exploratoires du Blongios

#A- Graphique de présence des Blongios par semaine depuis 1990

```{r}
## 1 : graphique des semaines de la vie, on regarde les présences de l'espèce chaque semaine depuis 1990. 

esp_blongios <- "Blongios nain, Butor blongios"

annees <- format(process_data$date_debut, "%Y")
annees <- as.numeric(annees)

# Trouver les années min et max
annee_min <- min(annees, na.rm = TRUE)
annee_max <- max(annees, na.rm = TRUE)
duree_annees <- annee_max - annee_min +1


data_blongios <- process_data %>%
  filter(nom_vernaculaire == esp_blongios) %>%#on filtre pour avoir uniquement les lignes du blongios dans le data frame
  mutate(
    annee_suivi = year(date_debut) - annee_min + 1,
    annee_reelle = year(date_debut),
    semaine = isoweek(date_debut)
  )

# --- Résumer les semaines pour gérer les sorties multiples ---
data_blongios_summarized <- data_blongios %>%
  mutate(
    is_obs = nombre_min > 0,
    is_protocole = grepl("SuiviBlongiosTalève", champs_additionnels) #on définit ce qu'est une observation protocolée
  ) %>%
  group_by(annee_suivi, semaine) %>%
  summarise(
    statut = case_when(
       # sorties avec observations 
      any(is_obs) & any(is_protocole & is_obs) & any(!is_protocole & is_obs) ~ "obs_mixte", # si dans une semaine il y a eu au moins 1 observation protocole ET 1 opportuniste, alors on définit ça en observation mixte 
      any(is_obs) & any(is_protocole & is_obs) ~ "obs_protocole", #si dans 1 semaine il y a eu au moins 1 observation protocolée (et aucune opportuniste) on définit en observation protocolée 
      any(is_obs) & any(!is_protocole & is_obs) ~ "obs_hors_protocole", #si dans 1 semaine il y a eu au moins 1 observation opportuniste (et aucune protocolée) on définit en observation hors protocole


      # sorties sans observation = aucun oiseau vu
      !any(is_obs) & any(nombre_min == 0) ~ "sortie_sans_observation",

      TRUE ~ NA_character_
    ),
    .groups = "drop"
  )
# --- Créer la grille complète (année x semaine) ---
grille <- expand.grid(
  annee_suivi = 1:duree_annees,
  semaine = 1:53
) %>%
  mutate(annee_reelle = annee_min + annee_suivi - 1) %>%
  left_join(
    data_blongios_summarized,
    by = c("annee_suivi", "semaine")
  ) %>%
  mutate(statut = ifelse(is.na(statut), "pas_de_sortie", statut)) # semaines sans sortie


grille <- grille %>%
  mutate(statut = factor(statut,
                         levels = c("obs_protocole", "obs_hors_protocole", "obs_mixte",
                                    "sortie_sans_observation", "pas_de_sortie")))

#on fait le graphique
ggplot(grille, aes(x = semaine, y = annee_reelle, fill = statut)) +
  geom_tile(color = "white", linewidth = 0.2) +
  geom_hline(yintercept = 2014, color = "blue", linetype = "dashed", size = 0.4)+
  scale_y_reverse() +
  scale_fill_manual(
    values = c(
      "obs_protocole" = "red",
      "obs_hors_protocole" = "green",
      "obs_mixte" = "purple",
      "sortie_sans_observation" = "black",
      "pas_de_sortie" = "grey85"
    ),
    labels = c(
      "Observation (protocole)",
      "Observation (hors protocole)",
      "Observation (mixte)",
      "Sortie sans observation",
      "Pas de sortie"
    )
  ) +
  labs(
    title = paste("Observations de", esp_blongios),
    subtitle = paste("Suivi de", annee_min, "à", annee_max),
    x = "Semaine de l'année",
    y = "Année"
  ) +
  theme_minimal() +
  theme(panel.grid = element_blank())






```

#B- Cartographie de la présence des Butors sur les sites d'écoute du protocole

```{r}
# on prend le dataframe des données uniquement protocolées (cf document clean_data pour sa création)
process_protocole <- read_csv("~/Desktop/M2/projet biodiversite/oiseaux_bagnas/data/pro/process_protocole.csv")

#on ne garde que les données du blongios 
process_protocole_blongios <- process_protocole %>%
  filter(nom_vernaculaire=="Blongios nain, Butor blongios")

#préparer les coordonnées pour R 
sites_protocole_blongios <- st_as_sf(process_protocole_blongios, coords = c("x_centroid_4326", "y_centroid_4326"), crs = 4326)

# on rassemble les données pour avoir un dataframe avec 1 ligne par site d'étude. L'objectif est d'avoir le nombre d'écoute de Blongios par site (somme depuis 2014)

sites_protocole_blongios <- sites_protocole_blongios %>%
  group_by(nom_lieu, nom_vernaculaire, geometry) %>%
  summarise(
    somme_nombre_min = sum(nombre_min, na.rm = TRUE),
    .groups = "drop"
  )


leaflet() %>%
  addTiles() %>%     # fond OSM

  addCircleMarkers(
    data =sites_protocole_blongios, #on prend les data frame résumé avec 1 ligne par site
    radius = ~somme_nombre_min,#la taille des points est proportionnelle au nombre d'oiseaux entendus
    color = "red",
    fillOpacity = 0.9,
    popup = ~paste ((nom_lieu), ", Blongios entendus :" ,(somme_nombre_min), sep = "")
  ) %>%  #cela nous donne le nom du lieu suivi du nombre de blongios entendu sur le site depuis 2014 
  setView(lng = 3.51, lat = 43.31, zoom = 13)


```

#C- Effort journalier du protocole Blongios

```{r}
# Données 
process_protocole <- read_csv("data/pro/process_protocole.csv")

Protocole_SuiviBlongiosTaleve <- process_protocole %>%
  filter(
    champs_additionnels == "{'RELV_NOM': 'SuiviBlongiosTalève'}" &
      nom_vernaculaire %in% c(
        "Blongios nain, Butor blongios",
        "Talève sultane, Poule sultane, Porphyrion bleu"
      )
  )
Protocole_Blongios <- Protocole_SuiviBlongiosTaleve %>%
  mutate(
    heure_debut = as.POSIXct(heure_debut, format = "%d/%m/%Y %H:%M:%S"),
    heure_debut_tronc = hour(heure_debut),
    date = as.Date(heure_debut)
  )

Protocole_Blongios <- Protocole_Blongios %>% filter( nom_vernaculaire == "Blongios nain, Butor blongios")

Protocole_Blongios <- Protocole_Blongios  %>%
  mutate(heure_debut = as.POSIXct(heure_debut, format = "%d/%m/%Y %H:%M:%S")) %>%
  filter(format(heure_debut, "%H:%M:%S") != "00:00:00")

# Table des 24 heures

heures_jour <- tibble(heure_debut_tronc = 0:23)

### Sommer les obs par heure

obs_heure <- Protocole_Blongios %>%
  group_by(heure_debut_tronc) %>%
  summarize(sum(nombre_min)) 
obs_heure

### Frequence horaire
freq_heure <- Protocole_Blongios %>% group_by(heure_debut_tronc) %>% summarise(freq = n()) %>% mutate(freq_rel = freq / sum(freq))

# Compléter les heures manquantes avec 0
data_plot_h <- heures_jour %>%
  left_join(freq_heure, by = "heure_debut_tronc") %>%
  left_join(obs_heure, by = "heure_debut_tronc") %>%
  mutate(
    freq = replace_na(freq, 0),
    `sum(nombre_min)` = replace_na(`sum(nombre_min)`, 0),
    heure_debut_tronc = factor(heure_debut_tronc, levels = 0:23)
  )

### Barplot

ggplot(data_plot_h, aes(x = heure_debut_tronc)) +
  geom_bar(aes(y = freq),
           stat = "identity",
           width = 0.8,
           fill = "orange") +
  geom_bar(aes(y = `sum(nombre_min)`),
           stat = "identity",
           width = 0.4,
           fill = "blue") +
  theme_classic() +
  scale_y_continuous(expand = c(0, 0)) +
  xlab("Heure de la journée") +
  ylab("Nombre de prospections (orange)\n et d'observations (bleu)") +
  ggtitle("Effort d'échantillonnage et nombre d'observations\n par heure pour le protocole Blongios (2014-2018)")
```

#D- Effort journalier des données opportunistes Blongios

```{r}
# Données 

Opportuniste_Blongios<- process_data %>%
  filter(
    !champs_additionnels == "{'RELV_NOM': 'SuiviBlongiostaleve'}" &
      nom_vernaculaire == "Blongios nain, Butor blongios"
  )

Opportuniste_Blongios <- Opportuniste_Blongios %>%
  mutate(
    heure_debut = as.POSIXct(heure_debut, format = "%d/%m/%Y %H:%M:%S"),
    heure_debut_tronc = hour(heure_debut),
    date = as.Date(heure_debut)
  )

 
Opportuniste_Blongios <- Opportuniste_Blongios  %>%
  mutate(heure_debut = as.POSIXct(heure_debut, format = "%d/%m/%Y %H:%M:%S")) %>%
  filter(format(heure_debut, "%H:%M:%S") != "00:00:00")

# Table des 24 heures

heures_jour <- tibble(heure_debut_tronc = 0:23)

### Sommer les obs par heure

obs_heure <- Opportuniste_Blongios %>%
  group_by(heure_debut_tronc) %>%
  summarize(sum(nombre_min)) 
obs_heure

### Frequence horaire
freq_heure <- Opportuniste_Blongios %>% group_by(heure_debut_tronc) %>% summarise(freq = n()) %>% mutate(freq_rel = freq / sum(freq))

# Compléter les heures manquantes avec 0
data_plot_h <- heures_jour %>%
  left_join(freq_heure, by = "heure_debut_tronc") %>%
  left_join(obs_heure, by = "heure_debut_tronc") %>%
  mutate(
    freq = replace_na(freq, 0),
    `sum(nombre_min)` = replace_na(`sum(nombre_min)`, 0),
    heure_debut_tronc = factor(heure_debut_tronc, levels = 0:23)
  )

### Barplot

ggplot(data_plot_h, aes(x = heure_debut_tronc)) +
  geom_bar(aes(y = freq),
           stat = "identity",
           width = 0.8,
           fill = "orange") +
  geom_bar(aes(y = `sum(nombre_min)`),
           stat = "identity",
           width = 0.4,
           fill = "blue") +
  theme_classic() +
  scale_y_continuous(expand = c(0, 0)) +
  xlab("Heure de la journée") +
  ylab("Nombre de prospections (orange)\n et d'observations (bleu)") +
  ggtitle("Effort d'échantillonnage et nombre d'observations opportuniste\n par heure pour le Blongios (2014-2018)")

```

##2 . Modèle de présence/absence

```{r}
# 
# 
# library(ggplot2)
# library(dplyr)
# library(broom)
# 
# ## Importation des données
# process_data <- read.csv("data/pro/process_protocole.csv", sep = ",")
# process_data$nombre_min <- ifelse(process_data$nombre_min > 0, 1, 0)
# HydrologicDataGrandBagnas <- read.csv("data/pro/DataHydroBagnas.csv", sep = ",")
# colnames(HydrologicDataGrandBagnas)[colnames(HydrologicDataGrandBagnas) == "Annee"] <- "annee"
# colnames(HydrologicDataGrandBagnas)[colnames(HydrologicDataGrandBagnas) == "Mois"] <- "mois"
# 
# 
# ## colonnes à garder
# cols_keep <- c(1, 2, 3, 6, 7, 12, 14)
# 
# ## filtre le tableau de données pour le blongios nain
# Protocole_SuiviBlongios <- process_data %>%
#   filter(nom_vernaculaire == "Blongios nain, Butor blongios") %>%
#   select(all_of(cols_keep))
# 
# ## ajoute des colonnes pour le jour julien et son effet quadratique
# Protocole_SuiviBlongios$date_debut <- as.Date(Protocole_SuiviBlongios$date_debut, format = "%Y-%m-%d")
# Protocole_SuiviBlongios$julian_day <- as.numeric(Protocole_SuiviBlongios$date_debut) #jour julien 
# Protocole_SuiviBlongios$julian_day2 <- Protocole_SuiviBlongios$julian_day^2 #jour julien au carré
# 
# ## ajoute les données hydrologiques au data frame des blongios
# Protocole_SuiviBlongios$annee <- as.integer(format(Protocole_SuiviBlongios$date_debut, "%Y"))
# Protocole_SuiviBlongios$mois <- as.integer(format(Protocole_SuiviBlongios$date_debut, "%m"))
# Protocole_SuiviBlongios <- merge(Protocole_SuiviBlongios, HydrologicDataGrandBagnas, by = c("annee", "mois"), all.x = TRUE)
# 

```

Modèle GLM présence des blongios en fonction du temps

```{r}
process_protocole <- read_csv("data/pro/process_protocole.csv")

Protocole_SuiviBlongios<- process_protocole %>%
  filter(
    champs_additionnels == "{'RELV_NOM': 'SuiviBlongiosTalève'}" &
      nom_vernaculaire %in% c(
        "Blongios nain, Butor blongios"
      )
  )

#standardidation
Protocole_SuiviBlongios$annee <- as.numeric(Protocole_SuiviBlongios$annee)
Protocole_SuiviBlongios$julian <- as.numeric(Protocole_SuiviBlongios$julian)
Protocole_SuiviBlongios$annee2 <- as.numeric(as.character(Protocole_SuiviBlongios$annee)) - 2013
Protocole_SuiviBlongios$nom_lieu<- as.character (Protocole_SuiviBlongios$nom_lieu)

# enviro 
Protocole_SuiviBlongios$temp_moy_glissante_31j <- scale(as.numeric(Protocole_SuiviBlongios$temp_moy_glissante_31j))
Protocole_SuiviBlongios$temp_moy_glissante_7j <- scale(as.numeric(Protocole_SuiviBlongios$temp_moy_glissante_7j))
Protocole_SuiviBlongios$pluie_moy_glissante_7j <- scale(as.numeric(Protocole_SuiviBlongios$pluie_moy_glissante_7j))
Protocole_SuiviBlongios$pluie_moy_glissante_31j <- scale(as.numeric(Protocole_SuiviBlongios$pluie_moy_glissante_31j))
Protocole_SuiviBlongios$vent_moyen <- scale(as.numeric(Protocole_SuiviBlongios$vent_moyen))
Protocole_SuiviBlongios$temperature = scale (as.numeric(Protocole_SuiviBlongios$temperature))
Protocole_SuiviBlongios$pluie_1h = scale (as.numeric(Protocole_SuiviBlongios$pluie_1h))

#hydro 

Protocole_SuiviBlongios$Profondeur <- scale( as.numeric(Protocole_SuiviBlongios$Profondeur ))
Protocole_SuiviBlongios$AssecT_1 <- as.factor(Protocole_SuiviBlongios$AssecT_1 )


## Modèle GLM avec la présence du blongios en fonction du temps
glm_blongios_temps <- glm(nombre_min ~ julian + I(julian^2), family = binomial, data = Protocole_SuiviBlongios)
summary(glm_blongios_temps)

## Modèles GLM avec la présence du blongios en fonction des conditions hydrologiques : la profondeur moyenne de l'eau et l'assec
glm_blongios_hydro <- glm(nombre_min ~ ProfondeurMoyenne + AssecT_1, family = binomial, data = Protocole_SuiviBlongios)
summary(glm_blongios_hydro)

## Modèles GLM avec la présence du blongios en fonction du temps et des conditions hydrologiques
glm_blongios_temps_hydro <- glm(nombre_min ~ julian + I(julian^2) + Profondeur + AssecT_1, family = binomial, data = Protocole_SuiviBlongios)
summary(glm_blongios_temps_hydro)


## TEST d'un graph qui montre la probabilité prédite de Blongios suivant l'assec qu'il y a eu la semaine précèdente

# Crée un dataframe pour prédictions par AssecT_1
pred_assec <- data.frame(
  AssecT_1 = unique(Protocole_SuiviBlongios$AssecT_1))

# On fixe la profondeur et le temps à leur moyenne pour isoler l'effet de l'Assec
pred_assec$Profondeur<- mean(Protocole_SuiviBlongios$Profondeur, na.rm = TRUE)
pred_assec$julian <- mean(Protocole_SuiviBlongios$julian, na.rm = TRUE)

# Prédictions de probabilité
pred_assec$prob <- predict(glm_blongios_temps_hydro, newdata = pred_assec, type = "response")

# Plot
ggplot(pred_assec, aes(x = AssecT_1, y = prob, fill = AssecT_1)) +
  geom_col() +
  scale_fill_brewer(palette = "Set2") +
  labs(
    x = "Assec de l'année précédente",
    y = "Probabilité prédite de présence",
    title = "Effet de l'Assec sur la présence du Blongios nain"
  ) +
  theme_classic() +
  theme(legend.position = "none")
```

##2.1 interpretation

Le modèle GLM examinant la présence du Blongios nain en fonction du temps, de la profondeur et de l’assec de l’année précédente montre plusieurs résultats intéressants. La date julienne sur plusieurs années et son terme quadratique sont toutes deux significatifs (p ≈ 0,0015), suggérant une évolution non linéaire et négative de la probabilité de présence au cours de la période 2014–2024. La profondeur moyenne n’a pas d’effet significatif (p = 0,34), ce qui indique que la présence de l’espèce n’est pas fortement liée aux variations de profondeur dans ce dataset. En revanche, l’assec de l’année précédente influence fortement la probabilité de présence: un assec partiel réduit la probabilité (Estimate = -2,19, p = 0,03) et un assec total encore davantage (Estimate = -4,27, p = 0,002)

## 3 . Modèle d'abondance

Cette analyse vise à caractériser la dynamique de la population de blongios et à déterminer l'influence relative des variables temporelles (année, date julienne) et environnementales (précipitations et temperatures) sur l'abondance observée.

## 3.1 Modèle d'abondance en fonction du temps

Nous réalisons cette analyse sur seulement les observations qui proviennent du protocole (donc pas les observations opportunistes)

```{r}
process_protocole <- read.csv("data/pro/process_protocole.csv", sep = ",")
Protocole_SuiviBlongios <- process_protocole %>%
  filter(
      nom_vernaculaire == "Blongios nain, Butor blongios"
  )

```

```{r}
# Preparation des variables ( standardisation )
process_protocole <- read_csv("data/pro/process_protocole.csv")

Protocole_SuiviBlongios<- process_protocole %>%
  filter(
    champs_additionnels == "{'RELV_NOM': 'SuiviBlongiosTalève'}" &
      nom_vernaculaire %in% c(
        "Blongios nain, Butor blongios",
        "Talève sultane, Poule sultane, Porphyrion bleu"
      )
  )


#standardidation
Protocole_SuiviBlongios$annee <- as.numeric(Protocole_SuiviBlongios$annee)
Protocole_SuiviBlongios$julian <- as.numeric(Protocole_SuiviBlongios$julian)
Protocole_SuiviBlongios$annee2 <- as.numeric(as.character(Protocole_SuiviBlongios$annee)) - 2013
Protocole_SuiviBlongios$nom_lieu<- as.character (Protocole_SuiviBlongios$nom_lieu)

# enviro 
Protocole_SuiviBlongios$temp_moy_glissante_31j <- scale(as.numeric(Protocole_SuiviBlongios$temp_moy_glissante_31j))
Protocole_SuiviBlongios$temp_moy_glissante_7j <- scale(as.numeric(Protocole_SuiviBlongios$temp_moy_glissante_7j))
Protocole_SuiviBlongios$pluie_moy_glissante_7j <- scale(as.numeric(Protocole_SuiviBlongios$pluie_moy_glissante_7j))
Protocole_SuiviBlongios$pluie_moy_glissante_31j <- scale(as.numeric(Protocole_SuiviBlongios$pluie_moy_glissante_31j))
Protocole_SuiviBlongios$vent_moyen <- scale(as.numeric(Protocole_SuiviBlongios$vent_moyen))
Protocole_SuiviBlongios$temperature = scale (as.numeric(Protocole_SuiviBlongios$temperature))
Protocole_SuiviBlongios$pluie_1h = scale (as.numeric(Protocole_SuiviBlongios$pluie_1h))

#hydro 

Protocole_SuiviBlongios$Profondeur <- scale( as.numeric(Protocole_SuiviBlongios$Profondeur ))
Protocole_SuiviBlongios$AssecT_1 <- as.factor(Protocole_SuiviBlongios$AssecT_1 )




```

```{r}
#  Modèle dans le temps 
# y ~ Pois ( lambda)

modele_annee <- glm(nombre_min ~ annee2, 
                    family = poisson, 
                    data = Protocole_SuiviBlongios)


modele_jour <- glm(nombre_min ~ julian, 
                   data = Protocole_SuiviBlongios, 
                   family = poisson)


modele_annee_jour <- glm(nombre_min ~ annee2 + julian, 
                         data = Protocole_SuiviBlongios, 
                         family = poisson)

modele_anneejour <- glm(nombre_min ~ annee2 * julian, 
                         data = Protocole_SuiviBlongios, 
                         family = poisson)

#modèle complet 
modeleB_complet_site <- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )

summary(modele_annee)
summary(modele_jour)
summary(modele_annee_jour)
summary(modele_anneejour)

AIC(modele_annee, modele_jour, modele_annee_jour, modele_anneejour)

```

## Interprétation

La sélection par l'AIC indique que le modèle incluant l'effet du jour julien est le plus performant. Nous retenons cette structure de base pour la suite des analyses, afin d'y intégrer et de tester l'influence des variables environnementales.

## 3.2 Modèle d'abondance en fonction du temps et de l'environnement

```{r}
modeleB_complet_vent <- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + vent_moyen,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )


modeleB_complet_temp_31 <- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + temp_moy_glissante_31j+ vent_moyen,
                              data = Protocole_SuiviBlongios, 
                              family = poisson )

modeleB_complet_temp_7j <- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + temp_moy_glissante_7j+ vent_moyen,
                              data = Protocole_SuiviBlongios, 
                              family = poisson )


modeleB_complet_temp_1j_vent<- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + temperature + vent_moyen,
                                  data = Protocole_SuiviBlongios, 
                                  family = poisson )

modeleB_complet_pluie_31j_vent<- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_31j + vent_moyen,
                                    data = Protocole_SuiviBlongios, 
                                    family = poisson )

modeleB_complet_pluie_7j_vent<- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + pluie_moy_glissante_7j + vent_moyen,
                                   data = Protocole_SuiviBlongios, 
                                   family = poisson )
modeleB_complet_pluie_1j_vent<- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + pluie_1h + vent_moyen,
                                   data = Protocole_SuiviBlongios, 
                                   family = poisson )





# avec hydro 

modeleB_complet_assec <- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + vent_moyen + AssecT_1,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )
                           
summary(modeleB_complet_assec)

modeleB_complet_profondeur <- glm(nombre_min~ annee2 + julian + I(julian^2)+ nom_lieu + vent_moyen + Profondeur,
                           data = Protocole_SuiviBlongios, 
                           family = poisson )

AIC(modeleB_complet_site, modeleB_complet_vent,modeleB_complet_temp_31,modeleB_complet_temp_7j,modeleB_complet_temp_1j_vent,modeleB_complet_pluie_31j_vent,modeleB_complet_pluie_7j_vent,modeleB_complet_pluie_1j_vent,modeleB_complet_assec,modeleB_complet_profondeur)
summary(modeleB_complet_profondeur)
```

> La comparaison des modèles par l’AIC montre que l’intégration de la pluie moyenne glissante sur 7 jours améliore légèrement la capacité prédictive du modèle. En revanche, les variables de température n'apportent aucune amélioration supplémentaire et n'ont donc pas été retenues.

Les paramètres estimés indiquent que :

-   La pluie moyenne glissante sur 7 jours a un effet négatif significatif sur l’abondance des talèves (β = -0.566, p =0.014). Donc uneaugemtation de la quantité de pluie engendre une diminution ou du nombre d’individus de blongios dans la reserve

-   Le jour julien présente un effet négatif significatif (β = −0.357 p = 0.039), indiquant une diminution de l’abondance au cours de la saison ( ce qui est logique car le protocole n'est pas effectué en fin d'année )

    Globalement, le modèle permet d’expliquer une part substantielle de la variabilité observée (déviance résiduelle = 166,96 contre une déviance nulle de 166.96), avec un AIC de 252.79.

-   La fonction pour trouver l'abondance du blongios en fonction de la pluie et des jours est :

    log(y) = -1.9136 -03572(julian\[i\]) - 0.5659(pluie\[i\])

    ```{r}
    #  Création d'un graphique de la fonction predite ; nombre d'individus en fonction de la pluie ( donc on fixe les jours pour avoir seulement l'effet pluie)
    data_pred <- data.frame(
      pluie_moy_glissante_7j = seq(min(Protocole_SuiviBlongios$pluie_moy_glissante_7j), 
    max(Protocole_SuiviBlongios$pluie_moy_glissante_7j), 
                                   length.out = 100),
      julian = 0
    )

    predictions <- predict(m_pluie_7, newdata = data_pred, type = "link", se.fit = TRUE)

    data_pred$fit <- exp(predictions$fit)
    data_pred$ucl <- exp(predictions$fit + 1.96 * predictions$se.fit)
    data_pred$lcl <- exp(predictions$fit - 1.96 * predictions$se.fit)

    # Le Graphique
    ggplot() +
      geom_ribbon(data = data_pred, aes(x = pluie_moy_glissante_7j, ymin = lcl, ymax = ucl), 
                  fill = "blue", alpha = 0.1) +

      geom_jitter(data = Protocole_SuiviBlongios, 
                  aes(x = pluie_moy_glissante_7j, y = nombre_min, color = "Observations"), 
                  alpha = 0.5, width = 0.05, height = 0.05) +
      geom_line(data = data_pred, 
                aes(x = pluie_moy_glissante_7j, y = fit, color = "Modèle GLM"), 
                size = 1) +
      scale_color_manual(name = "Légende", 
                         values = c("Observations" = "orange", "Modèle GLM" = "blue")) +
      
      labs(
        title = "Relation entre Pluie et Abondance de Blongios",
        x = "Pluie moyenne (standardisée)",
        y = "Nombre d'individus"
      ) +
      theme_minimal()
    ```


#plot 

```{r}
p1 <- plot(ggeffect(modeleB_complet_temp_7j, terms= "temp_moy_glissante_7j", residual = T))
p1

p2 = plot(ggeffect(modele_complet_assec, terms= "annee2", residual = T))
p2

p3 = plot(ggeffect(modele_complet_assec, terms= "nom_lieu", residual = T))
p3
```

